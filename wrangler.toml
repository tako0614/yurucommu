name = "yurucommu"
main = "src/backend/index.ts"
compatibility_date = "2024-12-01"
compatibility_flags = ["nodejs_compat", "global_fetch_strictly_public"]

[vars]
APP_URL = "https://app.yurucommu.com"

# Authentication Configuration
# Set any combination of the following to enable different auth methods:
#
# Password authentication:
# AUTH_PASSWORD = "your-password"  # Set via wrangler secret put
#
# Google OAuth:
# GOOGLE_CLIENT_ID = "xxx.apps.googleusercontent.com"
# GOOGLE_CLIENT_SECRET = "xxx"  # Set via wrangler secret put
#
# X/Twitter OAuth:
# X_CLIENT_ID = "xxx"
# X_CLIENT_SECRET = "xxx"  # Set via wrangler secret put
#
# Takos OAuth (enables Takos API access):
TAKOS_URL = "https://takos.jp"
# TAKOS_CLIENT_ID = "xxx"  # Set via wrangler secret put
# TAKOS_CLIENT_SECRET = "xxx"  # Set via wrangler secret put

# Secrets (set via wrangler secret put):
# - AUTH_PASSWORD (optional)
# - GOOGLE_CLIENT_ID, GOOGLE_CLIENT_SECRET (optional)
# - X_CLIENT_ID, X_CLIENT_SECRET (optional)
# - TAKOS_CLIENT_ID, TAKOS_CLIENT_SECRET (optional)

# D1 Database
[[d1_databases]]
binding = "DB"
database_name = "yurucommu-db"
database_id = "054f575a-1fa1-497a-9b27-3682d0155e23"
migrations_dir = "migrations"

# R2 Bucket
[[r2_buckets]]
binding = "MEDIA"
bucket_name = "yurucommu-media"

# KV Namespace (for OAuth state, sessions, etc.)
[[kv_namespaces]]
binding = "KV"
id = "yurucommu-kv"  # Replace with actual KV namespace ID after creation

# Static assets
[assets]
directory = "./dist"
binding = "ASSETS"
run_worker_first = true
not_found_handling = "single-page-application"

# Route
[[routes]]
pattern = "app.yurucommu.com/*"
zone_name = "yurucommu.com"

# Test environment
[env.test]
name = "yurucommu-test"
vars = { TAKOS_URL = "https://takos.jp", APP_URL = "https://test.yurucommu.com" }

[[env.test.d1_databases]]
binding = "DB"
database_name = "yurucommu-db"
database_id = "054f575a-1fa1-497a-9b27-3682d0155e23"
migrations_dir = "migrations"

[[env.test.r2_buckets]]
binding = "MEDIA"
bucket_name = "yurucommu-media"

[[env.test.kv_namespaces]]
binding = "KV"
id = "yurucommu-kv"  # Replace with actual KV namespace ID

[[env.test.routes]]
pattern = "test.yurucommu.com/*"
zone_name = "yurucommu.com"
