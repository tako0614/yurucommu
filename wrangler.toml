name = "yurucommu"
main = "src/backend/index.ts"
compatibility_date = "2024-12-01"
compatibility_flags = ["nodejs_compat", "global_fetch_strictly_public"]

[vars]
TAKOS_URL = "https://takos.jp"
APP_URL = "https://app.yurucommu.com"
AUTH_MODE = "password"

# Secrets (set via wrangler secret put):
# - TAKOS_CLIENT_ID
# - TAKOS_CLIENT_SECRET
# - AUTH_PASSWORD

# D1 Database
[[d1_databases]]
binding = "DB"
database_name = "yurucommu-db"
database_id = "054f575a-1fa1-497a-9b27-3682d0155e23"
migrations_dir = "migrations"

# R2 Bucket
[[r2_buckets]]
binding = "MEDIA"
bucket_name = "yurucommu-media"

# Static assets
[assets]
directory = "./dist"
binding = "ASSETS"
run_worker_first = true

# Route
[[routes]]
pattern = "app.yurucommu.com/*"
zone_name = "yurucommu.com"

# Test environment
[env.test]
name = "yurucommu-test"
vars = { TAKOS_URL = "https://takos.jp", APP_URL = "https://test.yurucommu.com", AUTH_MODE = "password" }

[[env.test.d1_databases]]
binding = "DB"
database_name = "yurucommu-db"
database_id = "054f575a-1fa1-497a-9b27-3682d0155e23"
migrations_dir = "migrations"

[[env.test.r2_buckets]]
binding = "MEDIA"
bucket_name = "yurucommu-media"

[[env.test.routes]]
pattern = "test.yurucommu.com/*"
zone_name = "yurucommu.com"
